<pre class="result"></pre>
<pre class="result-node_modules"></pre>

<script type="module" src="./dir/index.js"></script>
<script type="module">
  function useImports(modules, selector) {
    for (const path in modules) {
      modules[path]().then((mod) => {
        console.log(path, mod)
      })
    }

    const keys = Object.keys(modules)
    Promise.all(keys.map((key) => modules[key]())).then((mods) => {
      const res = {}
      mods.forEach((m, i) => {
        res[keys[i]] = m
      })
      document.querySelector(selector).textContent = JSON.stringify(
        res,
        null,
        2
      )
    })
  }

  const modules = import.meta.glob('/dir/**')
  useImports(modules, '.result')

  const nodeModules = import.meta.glob('/dir/node_modules/**')
  useImports(nodeModules, '.result-node_modules')
</script>
